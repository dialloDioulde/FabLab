{% include "siteWeb/includes/dashboard.html" %}

{% load crispy_forms_tags %}

{% load static %}

{% block content %}
<head>
      <script src="{% static 'jquery/external/jquery/tableSearch.js' %}"></script>
</head>

<div class="modal hide" id="contactModal">
</div>

<script>
    $(".contact").click(function(ev) { // for each edit contact url
        ev.preventDefault(); // prevent navigation
        var url = $(this).data("form"); // get the contact form url
        $("#contactModal").load(url, function() { // load the url into the modal
            $(this).modal('show'); // display the modal on url load
        });
        return false; // prevent the click propagation
    });

    $('.contact-form').live('submit', function() {
        $.ajax({
            type: $(this).attr('method'),
            url: this.action,
            data: $(this).serialize(),
            context: this,
            success: function(data, status) {
                $('#contactModal').html(data);
            }
        });
        return false;
    });
</script>

<div class="container">
    <h2>Materials</h2>
  <p>Type something in the input field to search the table for first names, last names or emails:</p>
  <input class="form-control" id="myInput" type="text" placeholder="Search..">
  <br>
    <table class="table table-bordered responsive" style="height:90vh">

        <thead class="thead-dark">
            <tr>
                <th scope="col">NAME</th>
                <th scope="col">BARCODE</th>
                <th scope="col">TYPE</th>
                 <th scope="col">DESCRIPTION</th>
                <th scope="col">CREATION DATE</th>
                <th scope="col">ACTIONS</th>
            </tr>
        </thead>

        {% for material in materials %}
        <tbody id="myTable">
        <tr>
            <td>{{material.name}}</td>
            <td>{{material.id}}</td>
            <td>{{material.slug}}</td>
            <td>{{material.type }}</td>
            <td>{{material.creation_date_mat}}</td>
            <td>
                <a href="/updateMaterial/{{material.id}}" class="btn btn-warning"><span class="glyphicon glyphicon-pencil mr-2"></span>Edit</a>
                <button  class="btn btn-danger ml-2" onClick="deleteMaterial({{material.id}})">
                    <span class="glyphicon glyphicon-trash mr-2"></span>Delete
                </button>
            </td>
        </tr>
        </tbody>
        {% endfor %}
    </table>
</div>
{% endblock %}


{% block javascript %}
<script>
 // Delete Material----------------------------------------------------------------------------------------------------//
function deleteMaterial(id) {
  var action_delete = confirm("Are you sure you want to delete this Material?");
  if (action_delete == true) {
    $.ajax({
        url: '{% url "DeleteCrudMaterial" %}',
        data: {
            'id': id,
        },
        dataType: 'json',
        success: function (data) {
            if (data.deleted) {
              alert("Material is deleted");
              location.reload(true);
            }
        }
    });
  }
};
// END Delete Material -----------------------------------------------------------------------------------------------//
</script>

{% endblock javascript %}